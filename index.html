<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>단어 문장 만들기</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Jua', cursive;
            background-color: #fce4ec;
        }

        .font-jua {
            font-family: 'Jua', cursive;
        }

        .card {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            padding: 2rem;
        }

        .btn-pink {
            background-color: #f48fb1;
            color: white;
            transition: transform 0.2s ease;
        }

        .btn-pink:hover {
            transform: scale(1.05);
            background-color: #e91e63;
        }

        .btn-purple {
            background-color: #ba68c8;
            color: white;
            transition: transform 0.2s ease;
        }

        .btn-purple:hover {
            transform: scale(1.05);
            background-color: #9c27b0;
        }

        .input-field {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.75rem;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #ba68c8;
        }

        .sentences-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .sentence-item {
            border-bottom: 1px solid #f0f0f0;
            padding: 1rem 0;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-gray-800 p-4">

    <div class="max-w-xl w-full space-y-8">
        <div class="card text-center">
            <h1 class="text-4xl font-bold font-jua text-gray-700 mb-2">단어 문장 만들기</h1>
            <p class="text-lg text-gray-600 mb-6">랜덤 단어를 받고, 문장을 만들어 친구들과 공유해 보세요!</p>

            <!-- 단어 생성 및 문장 입력 -->
            <div class="space-y-4">
                <button id="getWordBtn" class="btn-purple px-6 py-3 rounded-full font-bold">
                    랜덤 단어 받기 ✨
                </button>
                <div id="wordDisplay" class="text-3xl font-jua text-purple-700 font-bold h-10 flex items-center justify-center"></div>
                <input type="text" id="sentenceInput" placeholder="이 단어로 문장을 만들어 보세요!" class="input-field w-full" disabled>
                <button id="submitBtn" class="btn-pink px-6 py-3 rounded-full font-bold w-full flex items-center justify-center" disabled>
                    <span id="submitBtnText">문장 올리기 🚀</span>
                    <span id="submitSpinner" class="loading-spinner ml-2 hidden"></span>
                </button>
            </div>
        </div>

        <!-- 공유된 문장 목록 -->
        <div class="card">
            <h2 class="text-2xl font-bold font-jua text-gray-700 mb-4">모두의 문장들 💌</h2>
            <div id="sentencesList" class="sentences-list">
                <!-- 여기에 문장들이 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK 로드 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBKcqjp7W0zeloHDWgpR2rBvLTeZN1o2BY",
            authDomain: "firsr250917.firebaseapp.com",
            projectId: "firsr250917",
            storageBucket: "firsr250917.firebasestorage.app",
            messagingSenderId: "942745695002",
            appId:  "1:942745695002:web:dfce08815c61b5c56b32a3"
        };

        const appId = "random_word_story_app";
        let db = null;
        let sentencesRef = null;
        let currentWord = "";

        const getWordBtn = document.getElementById('getWordBtn');
        const wordDisplay = document.getElementById('wordDisplay');
        const sentenceInput = document.getElementById('sentenceInput');
        const submitBtn = document.getElementById('submitBtn');
        const submitBtnText = document.getElementById('submitBtnText');
        const submitSpinner = document.getElementById('submitSpinner');
        const sentencesList = document.getElementById('sentencesList');

        const words = [
            '햇살', '웃음', '바다', '하늘', '달콤함', '별빛', '모험', '꿈',
            '마법', '포근함', '반짝임', '비밀', '용기', '행복', '편지'
        ];

        // Firebase 초기화
        function initializeFirebase() {
            try {
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {
                    console.error("Firebase 설정 오류: 'YOUR_API_KEY'가 실제 값으로 변경되지 않았습니다.");
                    wordDisplay.textContent = "오류! Firebase 설정을 확인하세요.";
                    return;
                }
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                sentencesRef = db.collection(`artifacts/${appId}/public/data/sentences`);
                setupListeners();
                getWordBtn.disabled = false;
            } catch (error) {
                console.error("Firebase 초기화 중 오류 발생:", error);
                wordDisplay.textContent = "초기화 오류! 콘솔을 확인하세요.";
            }
        }

        // Firestore 리스너 설정
        function setupListeners() {
            sentencesRef.orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                sentencesList.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.classList.add('sentence-item');
                    item.innerHTML = `
                        <p class="text-xl font-jua mb-1">${data.sentence}</p>
                        <p class="text-sm text-gray-500">
                            단어: <span class="text-purple-600 font-bold">${data.word}</span>
                        </p>
                    `;
                    sentencesList.appendChild(item);
                });
            });
        }

        // 랜덤 단어 가져오기
        getWordBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * words.length);
            currentWord = words[randomIndex];
            wordDisplay.textContent = currentWord;
            sentenceInput.value = '';
            sentenceInput.disabled = false;
            submitBtn.disabled = false;
        });

        // 문장 업로드
        submitBtn.addEventListener('click', async () => {
            if (!currentWord) {
                console.log("먼저 단어를 받아야 합니다.");
                return;
            }
            const sentence = sentenceInput.value.trim();
            if (sentence === "") {
                alert("문장을 입력해주세요!");
                return;
            }

            // 제출 버튼 UI 업데이트
            submitBtn.disabled = true;
            submitBtnText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');

            try {
                await sentencesRef.add({
                    word: currentWord,
                    sentence: sentence,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                sentenceInput.value = '';
                wordDisplay.textContent = '';
                currentWord = "";
            } catch (e) {
                console.error("문서 추가 중 오류 발생: ", e);
            } finally {
                submitBtn.disabled = false;
                submitBtnText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', initializeFirebase);
    </script>
</body>
</html>
