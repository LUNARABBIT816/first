<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¨ì–´ ë¬¸ì¥ ë§Œë“¤ê¸°</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Jua', cursive;
            background-color: #fce4ec;
        }

        .font-jua {
            font-family: 'Jua', cursive;
        }

        .card {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            padding: 2rem;
        }

        .btn-pink {
            background-color: #f48fb1;
            color: white;
            transition: transform 0.2s ease;
        }

        .btn-pink:hover {
            transform: scale(1.05);
            background-color: #e91e63;
        }

        .btn-purple {
            background-color: #ba68c8;
            color: white;
            transition: transform 0.2s ease;
        }

        .btn-purple:hover {
            transform: scale(1.05);
            background-color: #9c27b0;
        }

        .input-field {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.75rem;
            transition: border-color 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #ba68c8;
        }

        .sentences-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .sentence-item {
            border-bottom: 1px solid #f0f0f0;
            padding: 1rem 0;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen text-gray-800 p-4">

    <div class="max-w-xl w-full space-y-8">
        <div class="card text-center">
            <h1 class="text-4xl font-bold font-jua text-gray-700 mb-2">ë‹¨ì–´ ë¬¸ì¥ ë§Œë“¤ê¸°</h1>
            <p class="text-lg text-gray-600 mb-6">ëœë¤ ë‹¨ì–´ë¥¼ ë°›ê³ , ë¬¸ì¥ì„ ë§Œë“¤ì–´ ì¹œêµ¬ë“¤ê³¼ ê³µìœ í•´ ë³´ì„¸ìš”!</p>

            <!-- ë‹¨ì–´ ìƒì„± ë° ë¬¸ì¥ ì…ë ¥ -->
            <div class="space-y-4">
                <button id="getWordBtn" class="btn-purple px-6 py-3 rounded-full font-bold">
                    ëœë¤ ë‹¨ì–´ ë°›ê¸° âœ¨
                </button>
                <div id="wordDisplay" class="text-3xl font-jua text-purple-700 font-bold h-10 flex items-center justify-center"></div>
                <input type="text" id="sentenceInput" placeholder="ì´ ë‹¨ì–´ë¡œ ë¬¸ì¥ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”!" class="input-field w-full" disabled>
                <button id="submitBtn" class="btn-pink px-6 py-3 rounded-full font-bold w-full flex items-center justify-center" disabled>
                    <span id="submitBtnText">ë¬¸ì¥ ì˜¬ë¦¬ê¸° ğŸš€</span>
                    <span id="submitSpinner" class="loading-spinner ml-2 hidden"></span>
                </button>
            </div>
        </div>

        <!-- ê³µìœ ëœ ë¬¸ì¥ ëª©ë¡ -->
        <div class="card">
            <h2 class="text-2xl font-bold font-jua text-gray-700 mb-4">ëª¨ë‘ì˜ ë¬¸ì¥ë“¤ ğŸ’Œ</h2>
            <div id="sentencesList" class="sentences-list">
                <!-- ì—¬ê¸°ì— ë¬¸ì¥ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK ë¡œë“œ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBKcqjp7W0zeloHDWgpR2rBvLTeZN1o2BY",
            authDomain: "firsr250917.firebaseapp.com",
            projectId: "firsr250917",
            storageBucket: "firsr250917.firebasestorage.app",
            messagingSenderId: "942745695002",
            appId:  "1:942745695002:web:dfce08815c61b5c56b32a3"
        };

        const appId = "random_word_story_app";
        let db = null;
        let sentencesRef = null;
        let currentWord = "";

        const getWordBtn = document.getElementById('getWordBtn');
        const wordDisplay = document.getElementById('wordDisplay');
        const sentenceInput = document.getElementById('sentenceInput');
        const submitBtn = document.getElementById('submitBtn');
        const submitBtnText = document.getElementById('submitBtnText');
        const submitSpinner = document.getElementById('submitSpinner');
        const sentencesList = document.getElementById('sentencesList');

        const words = [
            'í–‡ì‚´', 'ì›ƒìŒ', 'ë°”ë‹¤', 'í•˜ëŠ˜', 'ë‹¬ì½¤í•¨', 'ë³„ë¹›', 'ëª¨í—˜', 'ê¿ˆ',
            'ë§ˆë²•', 'í¬ê·¼í•¨', 'ë°˜ì§ì„', 'ë¹„ë°€', 'ìš©ê¸°', 'í–‰ë³µ', 'í¸ì§€'
        ];

        // Firebase ì´ˆê¸°í™”
        function initializeFirebase() {
            try {
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {
                    console.error("Firebase ì„¤ì • ì˜¤ë¥˜: 'YOUR_API_KEY'ê°€ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                    wordDisplay.textContent = "ì˜¤ë¥˜! Firebase ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
                    return;
                }
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                sentencesRef = db.collection(`artifacts/${appId}/public/data/sentences`);
                setupListeners();
                getWordBtn.disabled = false;
            } catch (error) {
                console.error("Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                wordDisplay.textContent = "ì´ˆê¸°í™” ì˜¤ë¥˜! ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.";
            }
        }

        // Firestore ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupListeners() {
            sentencesRef.orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                sentencesList.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const item = document.createElement('div');
                    item.classList.add('sentence-item');
                    item.innerHTML = `
                        <p class="text-xl font-jua mb-1">${data.sentence}</p>
                        <p class="text-sm text-gray-500">
                            ë‹¨ì–´: <span class="text-purple-600 font-bold">${data.word}</span>
                        </p>
                    `;
                    sentencesList.appendChild(item);
                });
            });
        }

        // ëœë¤ ë‹¨ì–´ ê°€ì ¸ì˜¤ê¸°
        getWordBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * words.length);
            currentWord = words[randomIndex];
            wordDisplay.textContent = currentWord;
            sentenceInput.value = '';
            sentenceInput.disabled = false;
            submitBtn.disabled = false;
        });

        // ë¬¸ì¥ ì—…ë¡œë“œ
        submitBtn.addEventListener('click', async () => {
            if (!currentWord) {
                console.log("ë¨¼ì € ë‹¨ì–´ë¥¼ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }
            const sentence = sentenceInput.value.trim();
            if (sentence === "") {
                alert("ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ì œì¶œ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
            submitBtn.disabled = true;
            submitBtnText.classList.add('hidden');
            submitSpinner.classList.remove('hidden');

            try {
                await sentencesRef.add({
                    word: currentWord,
                    sentence: sentence,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                sentenceInput.value = '';
                wordDisplay.textContent = '';
                currentWord = "";
            } catch (e) {
                console.error("ë¬¸ì„œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ", e);
            } finally {
                submitBtn.disabled = false;
                submitBtnText.classList.remove('hidden');
                submitSpinner.classList.add('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', initializeFirebase);
    </script>
</body>
</html>
